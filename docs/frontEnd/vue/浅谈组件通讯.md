---
title: æµ…è°ˆç»„ä»¶é€šè®¯
date: 2020-10-31
categories:
 - å‰ç«¯
tags:
- vue
---

## çˆ¶å­ç»„ä»¶ä¹‹é—´ğŸ§‘ğŸ‘¶
### 1. props[çˆ¶->å­ä¼ å€¼] & $emit[å­->çˆ¶å‘å°„äº‹ä»¶]

<br />çˆ¶ç»„ä»¶é€šè¿‡ `:propName='xxxx'`Â çš„æ–¹å¼ä¼ é€’å€¼ï¼Œå­ç»„ä»¶ç”¨ `props:{propName:{...}}`Â è¿›è¡Œæ¥æ”¶<br />å­ç»„ä»¶é€šè¿‡ `this.$emit('sonEventName'[,param1[,param2]])`Â çš„å½¢å¼ä¼ å‡ºäº‹ä»¶å  `sonEventName`Â å’Œå‚æ•° `param1,param2...`Â ï¼Œçˆ¶ç»„ä»¶åœ¨è‡ªå·±çš„å­ç»„ä»¶æ ‡ç­¾ä¸Šç”¨ `v-on`Â ç»‘å®šï¼š `@sonEventName = 'parEventName[(param1[,param2])]'` çš„æ–¹å¼æ¥æ”¶æ‰§è¡Œã€‚<br />
<br />**çˆ¶ç»„ä»¶**
```vue
<template>
    <div>
        çˆ¶ç»„ä»¶ï¼š{{money}}
        <son1 :money='money' @addMoney = 'addMoney'></son1>
    </div>
</template>
<script>
import son1 from './son1'
export default {
    components:{
        son1
    },
    data(){
        return {
            money:100
        }
    },
    methods:{
        addMoney(val){
            this.money = val
        }
    }
}
</script>

```
**å­ç»„ä»¶**
```vue
<template>
    <div>
        å„¿å­1è·å¾—{{money}}
        <button @click="raiseMoney">å¤šç»™ç‚¹å˜›</button>
    </div>
</template>
<script>
export default {
    props:{
        money:{
            type:Number,
            default:1
        }  
    },
    methods:{
        raiseMoney(){
            this.$emit('addMoney',200)
        }
    }
}
</script>

```
### 2. $parent å’Œ $children/$refs è·å–çˆ¶å­å…ƒç´ 


- **$parent**Â 

åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨ `this.$parent`Â å¯ä»¥è·å–åˆ°çˆ¶å®ä¾‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `this.$parent.xxdata = 'xxx'`Â çš„æ–¹å¼ä¿®æ”¹çˆ¶å…ƒç´ çš„å€¼

- $root

å¦å¤–æä¸€ä¸‹ï¼Œ `$root`Â æ˜¯ä¼šæŒ‡å‘å½“å‰ç»„ä»¶æ ‘çš„æ ¹ Vue å®ä¾‹ã€‚å¦‚æœå½“å‰å®ä¾‹æ²¡æœ‰çˆ¶å®ä¾‹ï¼Œæ­¤å®ä¾‹å°†ä¼šæ˜¯å…¶è‡ªå·±ã€‚

- **$children**Â 

çˆ¶å…ƒç´ è·å–å­å…ƒç´ çš„æ–¹å¼ï¼Œç”±äº `$children`Â **è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„**Â ï¼Œæ‰€ä»¥æ ¹æ®å®˜æ–¹æ–‡æ¡£æ‰€è¯´ï¼š
> **éœ€è¦æ³¨æ„ `$children` å¹¶ä¸ä¿è¯é¡ºåºï¼Œä¹Ÿä¸æ˜¯å“åº”å¼çš„ã€‚**

ä½¿ç”¨æ—¶éœ€è¦è°¨æ…<br />
<br />**$parent å’Œ $children æ˜¯ä¸åˆ©äºç»„ä»¶å¤ç”¨çš„ï¼Œä¸æ˜¯éå¸¸æ¨èã€‚**<br />**

- **$refs**

`$refs`Â å¯ä»¥ç»™æ¯ä¸€ä¸ªçˆ¶å…ƒç´ ä¸­ä½¿ç”¨çš„å­ç»„ä»¶èµ·åˆ«åï¼Œå°±å¯ä»¥ç²¾å‡†ä½¿ç”¨è‡ªå·±éœ€è¦çš„å­ç»„ä»¶Â <br />ç”¨æ³•ï¼š
```vue
// çˆ¶ç»„ä»¶
<son ref="aSon"/>

mounted(){
  console.log(this.$refs.aSon) //å³å¯æ‹¿åˆ°å­ç»„ä»¶çš„å®ä¾‹,å°±å¯ä»¥ç›´æ¥æ“ä½œ data å’Œ methods
}

```
### 3. .sync å’Œ v-model

<br />**.sync**

- éœ€æ±‚éœ€è¦å¯¹ä¸€ä¸ª prop è¿›è¡Œâ€œåŒå‘ç»‘å®šâ€ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒçœŸæ­£çš„åŒå‘ç»‘å®šä¼šå¸¦æ¥ç»´æŠ¤ä¸Šçš„é—®é¢˜ï¼Œå› ä¸ºå­ç»„ä»¶å¯ä»¥ä¿®æ”¹çˆ¶ç»„ä»¶ï¼Œä¸”åœ¨çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶éƒ½æ²¡æœ‰æ˜æ˜¾çš„æ”¹åŠ¨æ¥æºã€‚
```vue
// çˆ¶ç»„ä»¶
<son1 :money.sync='money'></son1>
//ç¼–è¯‘æ—¶ä¼šè¢«æ‰©å±•ä¸º
<son1 :money="money" @update:money="(val)=>this.money=val"></son1>

// å­ç»„ä»¶
// æ‰€ä»¥å­ç»„ä»¶å¯ä»¥é€šè¿‡$emit è§¦å‘ update æ–¹æ³•æ”¹å˜
  this.$emit('update:money',200)


```
**è‡ªå®šä¹‰ç»„ä»¶çš„ v-model**
> æ ¹æ®å®˜ç½‘çš„ä»‹ç»ï¼šä¸€ä¸ªç»„ä»¶ä¸Šçš„Â `v-model`Â é»˜è®¤ä¼šåˆ©ç”¨åä¸ºÂ `value`Â çš„ prop å’Œåä¸ºÂ `input`Â çš„äº‹ä»¶ï¼Œå³ï¼š

```vue
<son1 :value="money" @input="(val)=>this.money=val></son1>
```
ä¹Ÿå¯ä»¥å†™æˆ
```vue
<son1 v-model="money"></son1>
```
ä½†æ˜¯ `v-model`Â è¿™ç§æ–¹æ³•ï¼Œå­ç»„ä»¶åªèƒ½æ¥æ”¶ `value`Â è¿™ä¸€ä¸ªé»˜è®¤çš„ prop å…·æœ‰å±€é™æ€§ï¼Œè€Œ `.sync`Â å¯ä»¥éšæ„èµ·åå­—ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†ä¸€ä¸ªæ‰©å±•çš„åŠæ³•ï¼Œè¯¦è§[è¿™é‡Œ](https://cn.vuejs.org/v2/guide/components-custom-events.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84-v-model)Â 
## ç¥–å­™ç»„ä»¶ä¹‹é—´ğŸ‘´ğŸ‘¶
### 1. $attrs å’Œ $listeners

1. **$attrs**
> åŒ…å«äº†çˆ¶ä½œç”¨åŸŸä¸­ä¸ä½œä¸º prop è¢«è¯†åˆ« (ä¸”è·å–) çš„ attribute ç»‘å®š (`class`Â å’ŒÂ `style`Â é™¤å¤–)ã€‚å½“ä¸€ä¸ªç»„ä»¶æ²¡æœ‰å£°æ˜ä»»ä½• prop æ—¶ï¼Œè¿™é‡Œä¼šåŒ…å«æ‰€æœ‰çˆ¶ä½œç”¨åŸŸçš„ç»‘å®š (`class`Â å’ŒÂ `style`Â é™¤å¤–)ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡Â `v-bind="$attrs"`Â ä¼ å…¥å†…éƒ¨ç»„ä»¶â€”â€”åœ¨åˆ›å»ºé«˜çº§åˆ«çš„ç»„ä»¶æ—¶éå¸¸æœ‰ç”¨ã€‚



å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š
```vue
<template>
  <div>
    <p>æˆ‘æ˜¯çˆ¶ç»„ä»¶</p>
    <test :name="tom" :age="12" :id="12345" class="child" style="color: red" />
  </div>
</template>

<script>
export default {
  components: {
    test: {
      template: `
      <div>
        <p>æˆ‘æ˜¯å­ç»„ä»¶</p>
        <test2 v-bind="$attrs" s1="sss" s2="sss" />
      </div>`,
      props: ["name"],
      created() {
        console.log(this.$attrs); // {age: 12, id: 12345}
      },
      components: {
        test2: {
          template: `<p>æˆ‘æ˜¯å­™å­ç»„ä»¶</p>`,
          props: ["age", "s1"],
          created() {
            console.log(this.$attrs); // {s2: "sss", id: 12345}
          }
        }
      }
    }
  }
};
</script>

```
æˆ‘ä»¬ä¸€å±‚ä¸€å±‚æ¥åˆ†æï¼š

- çˆ¶çº§å‘é€ç»™ä¸‹çº§ name age id class style äº”ä¸ªå‚æ•°ï¼Œç”±äº class å’Œ style ä¸å±äºèŒƒç•´
> åŒ…å«äº†çˆ¶ä½œç”¨åŸŸä¸­ä¸ä½œä¸º prop è¢«è¯†åˆ« (ä¸”è·å–) çš„ attribute ç»‘å®š (`class`Â å’ŒÂ `style`Â é™¤å¤–)

æ‰€ä»¥åªä¼ ä¸‹å» name age id

- å­ç»„ä»¶çš„ `props`Â å†…å·²ç»å£°æ˜äº† name ï¼Œæ‰€ä»¥ `this.$attrs`Â åªå‰©ä¸‹ `{age: 12, id: 12345}`Â 
- å­ç»„ä»¶åˆç»™å­™ç»„ä»¶ä¼ äº† s1 å’Œ s2 ï¼Œï¼ˆå¯ä»¥å‡å®šè®¤ä¸ºæ­¤æ—¶ `this.$attr` Â ï¼‰ä½†æ˜¯å­™ç»„ä»¶çš„ `props`Â åˆå£°æ˜äº† age å’Œ s1ï¼Œé‚£ä¹ˆ `this.$attrs` åªå‰©ä¸‹ Â `{s2: "sss", id: 12345}`Â ï¼Œè€Œ age å’Œ id æ˜¯çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„ï¼Œæ­¤æ—¶å°±å·²ç»ä¼ åˆ°å­™ç»„ä»¶äº†



ä¹Ÿå°±æ˜¯è¯´æ‰€æ¥å—åˆ°çš„å±æ€§æ˜¯ä¸åŒ…å«classã€styleã€å’Œå·²ç»è¢«propè·å–çš„åˆ°çš„ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å­ç»„ä»¶ä¸­çš„é…ç½®é¡¹[**inheritAttrs**](https://cn.vuejs.org/v2/api/#inheritAttrs)**:**
> é»˜è®¤æƒ…å†µä¸‹çˆ¶ä½œç”¨åŸŸçš„ä¸è¢«è®¤ä½œ props çš„ attribute ç»‘å®š (attribute bindings) å°†ä¼šâ€œå›é€€â€ä¸”ä½œä¸ºæ™®é€šçš„ HTML attribute åº”ç”¨åœ¨**å­ç»„ä»¶çš„æ ¹å…ƒç´ ä¸Š**ã€‚å½“æ’°å†™åŒ…è£¹ä¸€ä¸ªç›®æ ‡å…ƒç´ æˆ–å¦ä¸€ä¸ªç»„ä»¶çš„ç»„ä»¶æ—¶ï¼Œè¿™å¯èƒ½ä¸ä¼šæ€»æ˜¯ç¬¦åˆé¢„æœŸè¡Œä¸ºã€‚**é€šè¿‡è®¾ç½®Â `inheritAttrs`Â åˆ°Â `false`ï¼Œè¿™äº›é»˜è®¤è¡Œä¸ºå°†ä¼šè¢«å»æ‰**ã€‚è€Œé€šè¿‡ (åŒæ ·æ˜¯ 2.4 æ–°å¢çš„) å®ä¾‹ propertyÂ `$attrs`Â å¯ä»¥è®©è¿™äº› attribute ç”Ÿæ•ˆï¼Œä¸”å¯ä»¥é€šè¿‡Â `v-bind`Â æ˜¾æ€§çš„ç»‘å®šåˆ°éæ ¹å…ƒç´ ä¸Šã€‚

ç¿»è¯‘æˆäººè¯å°±æ˜¯æŠŠ `$attr`Â ä¸Šçš„æ²¡æœ‰åœ¨ `props`Â é‡Œçš„å€¼æ‰”åˆ°å½“å‰ç»„ä»¶çš„æ ¹å…ƒç´ ä¸Šï¼Œå…·ä½“æ˜¯å•¥æ ·å‘¢ï¼š
```vue
<template>
  <div>
    <p>æˆ‘æ˜¯çˆ¶ç»„ä»¶</p>
    <test :name="tom" :age="12" class="child" style="color: red" />
  </div>
</template>

<script>
export default {
  components: {
    test: {
      template: `<p>æˆ‘æ˜¯å­ç»„ä»¶</p>`,
      props: ["name"],
      inheritAttrs: true,  // é»˜è®¤ä¸º true
      created() {
        console.log(this.$attrs); // {age: "12"}
      }
    }
  }
};
</script>

```
æµè§ˆå™¨è§£æå‡ºæ¥å°±æ˜¯è¿™æ ·çš„ï¼šageåœ¨æ ¹ä¸Š
```html
<div>
  <p data-v-469af010>æˆ‘æ˜¯çˆ¶ç»„ä»¶</p>
  <p data-v-469af010 age="12" class="child" style="color: red;">æˆ‘æ˜¯å­ç»„ä»¶</p>
</div>

```
å¦‚æœè®¾ç½® `inheritAttrs: false`Â æˆ–è€…ä¸è®¾ç½®ï¼Œ ageå°±æ²¡äº†ï¼š
```html
<div>
  <p data-v-469af010>æˆ‘æ˜¯çˆ¶ç»„ä»¶</p>
  <p data-v-469af010 class="child" style="color: red;">æˆ‘æ˜¯å­ç»„ä»¶</p>
</div>

```


2. **$listeners**
> åŒ…å«äº†çˆ¶ä½œç”¨åŸŸä¸­çš„ (ä¸å«Â `.native`Â ä¿®é¥°å™¨çš„)Â `v-on`Â äº‹ä»¶ç›‘å¬å™¨ã€‚å®ƒå¯ä»¥é€šè¿‡Â `v-on="$listeners"`Â ä¼ å…¥å†…éƒ¨ç»„ä»¶â€”â€”åœ¨åˆ›å»ºæ›´é«˜å±‚æ¬¡çš„ç»„ä»¶æ—¶éå¸¸æœ‰ç”¨ã€‚


<br />è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä»£ç åšäº†ä»€ä¹ˆï¼š

- ç±»ä¼¼äºæˆ‘ä»¬ä½¿ç”¨ `$emit`Â ï¼Œæˆ‘ä»¬è¿™é‡Œåœ¨å­™ç»„ä»¶ä½¿ç”¨äº† `this.$listeners.methodName([param1[,param2]])` çš„å½¢å¼ï¼Œå‘å¤–å‘å°„äº†ä¸€ä¸ªäº‹ä»¶ todo
- åœ¨å­ç»„ä»¶ `sonButton`Â é‡Œç”¨ `v-on="$listeners"`Â ä¼ é€’è¿™ä¸ªäº‹ä»¶ï¼Œè¿™ä¸ªå†™æ³•ç±»ä¼¼äº `v-bind="$attrs"`Â 
- åœ¨çˆ¶ç»„ä»¶ä¸­ï¼Œç”¨ `@methodName="[çˆ¶ç»„ä»¶ method å]"`Â æ¥ä½¿ç”¨ï¼Œè¿™ä¸ªå’Œæ­£å¸¸çˆ¶å­é€šä¿¡ä¸€æ ·çš„
- æ³¨æ„å­™ç»„ä»¶å’Œå­ç»„ä»¶çš„æ‰“å°å†…å®¹ï¼Œéƒ½æ˜¯ä¼šå®Œæ•´çš„æ‹¿åˆ°çˆ¶ç»„ä»¶ç»‘å®šçš„æ‰€æœ‰æ–¹æ³•
```vue
<div id="app">
    {{msg}}
    <son-button @todo="handleClick"></son-button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.7/vue.common.dev.js"></script>
  <script>
    let vm = new Vue({
      el: '#app',
      data: {
        msg: ''
      },
      methods: {
        handleClick(grandsonMsg) {
          this.msg = grandsonMsg
        }
      },
      components: {
        'sonButton': {
          template: `<grand-son-button v-on="$listeners"></grand-son-button>`,
          created() {
            console.log('son listeners',this.$listeners) // åŒ…å«çˆ¶çº§æ‰€æœ‰ç»‘å®šçš„æ–¹æ³•
          },
          components: {
            'grandSonButton': {
              template: `<button @click="grandSonClick">grandSon</button>`,
              created() {
                console.log('grandSon listeners',this.$listeners) // åŒ…å«çˆ¶çº§æ‰€æœ‰ç»‘å®šçš„æ–¹æ³•
              },
              methods: {
                grandSonClick() {
                  this.$listeners.todo('a msg from grandson')
                }
              }
            },
          }
        },
      }
    })
  </script>
```
è¿è¡Œæ•ˆæœï¼š<br />![WWWW.gif](https://gitee.com/rodrick278/img/raw/master/img/1604142833162-7caa3ea0-58c5-44ed-9f6e-b4dbb28bdff8.gif)
### 2. [provide å’Œ inject](https://cn.vuejs.org/v2/api/#provide-inject)

<br />å…ˆçœ‹ä¸‹å®˜ç½‘çš„ä»‹ç»ï¼š
> - **provide**ï¼š`Object | () => Object`
> - **inject**ï¼š`Array<string> | { [key: string]: string | Symbol | Object }`
> - è¿™å¯¹é€‰é¡¹éœ€è¦ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å…è®¸ä¸€ä¸ªç¥–å…ˆç»„ä»¶å‘å…¶æ‰€æœ‰å­å­™åä»£æ³¨å…¥ä¸€ä¸ªä¾èµ–ï¼Œä¸è®ºç»„ä»¶å±‚æ¬¡æœ‰å¤šæ·±ï¼Œå¹¶åœ¨å…¶ä¸Šä¸‹æ¸¸å…³ç³»æˆç«‹çš„æ—¶é—´é‡Œå§‹ç»ˆç”Ÿæ•ˆã€‚å¦‚æœä½ ç†Ÿæ‚‰ Reactï¼Œè¿™ä¸ React çš„ä¸Šä¸‹æ–‡ç‰¹æ€§å¾ˆç›¸ä¼¼ã€‚
> 
`provide` é€‰é¡¹åº”è¯¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è¿”å›ä¸€ä¸ªå¯¹è±¡çš„å‡½æ•°ã€‚è¯¥å¯¹è±¡åŒ…å«å¯æ³¨å…¥å…¶å­å­™çš„ propertyã€‚
> `inject` é€‰é¡¹åº”è¯¥æ˜¯ï¼š
> - ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œæˆ–
> - ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„ key æ˜¯æœ¬åœ°çš„ç»‘å®šåï¼Œvalue æ˜¯ï¼š

>    - åœ¨å¯ç”¨çš„æ³¨å…¥å†…å®¹ä¸­æœç´¢ç”¨çš„ key (å­—ç¬¦ä¸²æˆ– Symbol)ï¼Œæˆ–
>    - ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ï¼š

>       - `from` property æ˜¯åœ¨å¯ç”¨çš„æ³¨å…¥å†…å®¹ä¸­æœç´¢ç”¨çš„ key (å­—ç¬¦ä¸²æˆ– Symbol)
>       - `default` property æ˜¯é™çº§æƒ…å†µä¸‹ä½¿ç”¨çš„ value


<br />éå“åº”å¼çš„æ•°æ®ä¼ å€¼ä»£ç æ¼”ç¤º
```vue
// parent çˆ¶ç»„ä»¶
<template>
  <div>
    <h1 ref="h1">çˆ¶ç»„ä»¶</h1>
    <p @click="changeData">{{ msg }}</p>
    <children ref="children"></children>
  </div>
</template>
<script>
import Children from './children';
export default {
  name: 'praent',
  components: {
    Children
  },
  data() {
    return {
      msg: 'æ¥è‡ªçˆ¶äº²çš„å€¼'
    };
  },
  methods: {
    changeData() {
      this.msg = 'çˆ¶ç»„ä»¶æ”¹å˜äº†å‘ä¸‹ä¼ é€’çš„msgå€¼';
    }
  },
  provide() {
    return {
      msg: this.msg
    };
  }
};
</script>

```
```vue
// children å­ç»„ä»¶
<template>
  <div class="children">
    <h2 ref="h2">å­èŠ‚ç‚¹</h2>
    <p>{{ msg }}</p>
    <grandson></grandson>
  </div>
</template>
<script>
import Grandson from './grandson';
export default {
  name: 'children',
  components: {
    Grandson
  },
  inject: ['msg']
};
</script>

```
å¯åŠ¨é¡µé¢ï¼Œç‚¹å‡»çˆ¶ç»„ä»¶pæ ‡ç­¾ï¼Œçˆ¶ç»„ä»¶çš„å€¼å·²ç»ä¿®æ”¹äº†ï¼Œå‘ä¸‹ä¼ é€’çš„å€¼å¹¶æ²¡æœ‰ä¿®æ”¹<br />![](https://gitee.com/rodrick278/img/raw/master/img/1604146207039-50bd21cc-3e13-42af-bd7a-2007e730b2fe.gif)<br />å¦‚æœä¼ å…¥çš„å€¼ä¸ºå“åº”å¼çš„
```vue
<template>
  <div>
    <h1 ref="h1">çˆ¶ç»„ä»¶</h1>
    <p @click="changeData">{{ msg.value }}</p>
    <children ref="children"></children>
  </div>
</template>
<script>
import Children from './children';
export default {
  name: 'praent',
  components: {
    Children
  },
  data() {
    return {
        // ç¨å¾®æŠŠmsgçš„å€¼æ”¹ä¸ºä¸€ä¸ªå¯¹è±¡
      msg: { value: 'æ¥è‡ªçˆ¶äº²çš„å€¼' }
    };
  },
  methods: {
    changeData() {
      this.msg.value = 'çˆ¶ç»„ä»¶æ”¹å˜äº†å‘ä¸‹ä¼ é€’çš„msgå€¼';
    }
  },
  provide() {
    return {
      msg: this.msg
    };
  }
};
</script>
```
```vue
// children å­ç»„ä»¶
<template>
  <div class="children">
    <h2 ref="h2">å­èŠ‚ç‚¹</h2>
    <p>{{ msg.value }}</p>
    <grandson></grandson>
  </div>
</template>
<script>
import Grandson from './grandson';
export default {
  name: 'children',
  components: {
    Grandson
  },
  inject: ['msg']
};
</script>

```
```vue
// grandson å­™ç»„ä»¶
<template>
  <div class="grandson">
    <h3>å­™ç»„ä»¶</h3>
    <p>{{ msg.value }}</p>
  </div>
</template>
<script>
export default {
  name: 'grandson'
  inject: ['msg']
};
</script>

```
å¯åŠ¨é¡µé¢ï¼Œæ­¤æ—¶å†å»ç‚¹å‡»çˆ¶ç»„ä»¶çš„pæ ‡ç­¾ï¼Œç°åœ¨ä¸å•å•çˆ¶ç»„ä»¶çš„å€¼æ›´æ–°äº†ï¼Œè¿åŒå­ç»„ä»¶å’Œå­™ç»„ä»¶çš„å€¼éƒ½å‘ç”Ÿå˜åŒ–äº†<br />![](https://gitee.com/rodrick278/img/raw/master/img/1604146206888-dab38192-a812-48a8-8ba4-a4a988e02629.gif)<br />å°†å­™ç»„ä»¶ç¨å¾®ä¿®æ”¹ä¸€ä¸‹,å®šä¹‰ä¸€ä¸ªå€¼å»å­˜å‚¨injectæ¥å—åˆ°çš„å“åº”å¼çš„å€¼ï¼Œå†é€šè¿‡ç‚¹å‡»äº‹ä»¶å»ä¿®æ”¹å€¼ï¼Œ
```vue
<template>
  <div class="grandson">
    <h3>å­™ç»„ä»¶</h3>
    <p @click="changeMsg">{{ grandsonMsg.value }}</p>
  </div>
</template>
<script>
export default {
  name: 'grandson',
  data() {
    return {
      // ç”¨æ¥ä¿å­˜injectæ¥æ”¶åˆ°çš„æ•´ä¸ªã€msgå¯¹è±¡ã€‘
      grandsonMsg: ''
    }
  },
  mounted(){
		this.grandsonMsg = this.msg
  },
  inject: ['msg'],
  methods:{
    changeMsg(){
      // æ”¹å˜injectæ¥æ”¶åˆ°çš„å€¼ï¼Œå¯ä»¥æ”¹å˜æ•´æ¡é“¾è·¯ä¸Šçš„msgå¯¹è±¡çš„value
      this.grandsonMsg.value = 'å­™ç»„ä»¶ä¿®æ”¹äº†msgå€¼'
    }
  }
};
</script>

```
å¯ä»¥çœ‹åˆ°ï¼Œå­™ç»„ä»¶æ¥å—åˆ°è¿™ä¸ªå“åº”å¼çš„å€¼ï¼Œç„¶åé€šè¿‡è¿™ç§çš„æ–¹å¼å»ä¿®æ”¹è¿™ä¸ªå€¼ï¼ŒåŒæ ·å¯ä»¥ä¿®æ”¹åˆ°çˆ¶ç»„ä»¶provideä¸‹æ¥çš„å€¼<br />![](https://gitee.com/rodrick278/img/raw/master/img/1604146206863-1f9d78f4-2db6-41aa-8c67-bd51ba5d5ec4.gif)<br />

## å…¶ä»–ä¼ é€’ï¼ˆå…„å¼ŸèŠ‚ç‚¹æˆ–é•¿è·ç¦»ï¼‰ğŸ§’ğŸ‘¦
### 1. äº‹ä»¶æ€»çº¿$bus
**1.1 åœºæ™¯**<br />
<br />è¿™é‡Œä»¥é¡¹ç›®ä¸­å®é™…åœºæ™¯ä¸¾ä¾‹ï¼š<br />
<br />![](https://gitee.com/rodrick278/img/raw/master/img/image-20201026224122193.png)<br />
<br />æˆ‘æƒ³è¦åœ¨`GoodsListItem` ç»„ä»¶ä¸­æ¯ä¸€ä¸ª`item` åŠ è½½å®Œåè°ƒç”¨ä¸€æ¬¡`Scroll` ç»„ä»¶å‘é€ç»™`Home` çš„`refresh` äº‹ä»¶ï¼Œä½†æ˜¯ `GoodsListItem` æ˜¯`GoogsItem` ç»„ä»¶çš„å­ç»„ä»¶ï¼Œä¸èƒ½å¤Ÿç›´æ¥å»`Home` æ‹¿äº‹ä»¶ï¼Œç”±äºç»„ä»¶ç¦»å¾—å¤ªè¿œï¼Œä¸€å±‚å±‚ä¼ äº‹ä»¶è¿‡äºéº»çƒ¦ï¼Œè¿™æ—¶å€™å°±ç”¨ä¸Šäº†äº‹ä»¶æ€»çº¿`$bus` æ¥ç®¡ç†è¿™ä¸ªäº‹ä»¶<br />
<br />**1.2 ä½¿ç”¨**<br />**

1. main.jsä¸­åœ¨VueåŸå‹é“¾ä¸ŠæŠŠä»–åŠ ä¸Š



```javascript
import Vue from 'vue'
import App from './App.vue'
import router from './router'
import store from './store'

Vue.prototype.$bus = new Vue() // event Bus ç”¨äºæ— å…³ç³»ç»„ä»¶é—´çš„é€šä¿¡ã€‚

Vue.config.productionTip = false

new Vue({
  router,
  store,
  render: h => h(App)
}).$mount('#app')
```


2. ä¸‹çº§ç»„ä»¶ä¸­å‘å°„äº‹ä»¶


<br />ä½¿ç”¨`this.$bus.$emit('äº‹ä»¶å',params)`<br />
<br />GoodsListItem.vue<br />
<br />`img` æ ‡ç­¾ä¸­ä½¿ç”¨`@load` ç›‘å¬å›¾ç‰‡åŠ è½½å®Œæˆæ—¶é—´<br />
<br />ç›¸å½“äºåŸç”Ÿjsçš„`<img src="xxxxx" onload="imgLoad()">`<br />

```vue
  <img :src="goodsItem.show.img" alt="" @load="imgLoad"/>
  
  methods:{
    imgLoad(){
      // è¿™é‡Œä½¿ç”¨äº‹ä»¶æ€»çº¿$bus $buså’ŒvuexåŒºåˆ«åœ¨äº$busæ˜¯ç”¨äºç®¡ç†äº‹ä»¶çš„ç›‘å¬ vuexä¸»è¦ç®¡ç†çŠ¶æ€
      this.$bus.$emit('itemImgLoad')
    }
  }
```


3. ä¸Šçº§ç»„ä»¶æ‹¿åˆ°äº‹ä»¶


<br />ä½¿ç”¨`this.$bus.$on('äº‹ä»¶å',(params)=>{do sth...})`<br />
<br />Home.vue<br />

```javascript
created() {
    // 3.ç›‘å¬äº‹ä»¶æ€»çº¿çš„å›¾ç‰‡åŠ è½½äº‹ä»¶
    this.$bus.$on("itemImgLoad", () => {
      // ä½œç”¨æ˜¯å¯ä»¥åœ¨å›¾ç‰‡åŠ è½½åé‡æ–°è®¡ç®—ç°åœ¨å¯æ»šåŠ¨åŒºåŸŸçš„é«˜åº¦ï¼Œé¿å…å›¾ç‰‡è¿˜æ²¡åŠ è½½ç»“æŸå°±å·²ç»ç®—å¥½é«˜åº¦ï¼Œæˆ–è€…åˆ‡æ¢ç±»åˆ«çš„æ—¶å€™ç”¨ä¸Šä¸€ä¸ªç±»åˆ«çš„é«˜åº¦
      this.$refs.scroll.scroll.refresh();
    });
  },
```


### 2. vuex
å‚è€ƒ [vuex ä¸“é—¨çš„æ–‡ç« ](https://www.yuque.com/rodrick-miz0p/dfbyfg/ixdaiy)
