---
title: vue中事件总线的使用
date: 2020-10-26
categories:
 - 前端
tags:
- vue
---

# vue中事件总线$bus的使用

## 一、场景

这里以项目中实际场景举例：

![image-20201026224122193](https://gitee.com/rodrick278/img/raw/master/img/image-20201026224122193.png)

我想要在`GoodsListItem` 组件中每一个`item` 加载完后调用一次`Scroll` 组件发送给`Home` 的`refresh` 事件，但是 `GoodsListItem` 是`GoogsItem` 组件的子组件，不能够直接去`Home` 拿事件，由于组件离得太远，一层层传事件过于麻烦，这时候就用上了事件总线`$bus` 来管理这个事件

## 二、和vuex的区别

其实很简单，`$bus` 主要是负责事件的管理，而`vuex` 主要是负责状态的管理

## 三、使用

### 3.1 使用方法

1. main.js中在Vue原型链上把他加上

```js
import Vue from 'vue'
import App from './App.vue'
import router from './router'
import store from './store'

Vue.prototype.$bus = new Vue() // event Bus 用于无关系组件间的通信。

Vue.config.productionTip = false

new Vue({
  router,
  store,
  render: h => h(App)
}).$mount('#app')
```

2. 下级组件中发射事件

使用`this.$bus.$emit('事件名',params)`

GoodsListItem.vue

 `img` 标签中使用`@load` 监听图片加载完成时间

相当于原生js的`<img src="xxxxx" onload="imgLoad()">` 

```vue
  <img :src="goodsItem.show.img" alt="" @load="imgLoad"/>
  
  methods:{
    imgLoad(){
      // 这里使用事件总线$bus $bus和vuex区别在于$bus是用于管理事件的监听 vuex主要管理状态
      this.$bus.$emit('itemImgLoad')
    }
  }
```

3. 上级组件拿到事件

使用`this.$bus.$on('事件名',(params)=>{do sth...})` 

Home.vue

```js
created() {
    // 3.监听事件总线的图片加载事件
    this.$bus.$on("itemImgLoad", () => {
      // 作用是可以在图片加载后重新计算现在可滚动区域的高度，避免图片还没加载结束就已经算好高度，或者切换类别的时候用上一个类别的高度
      this.$refs.scroll.scroll.refresh();
    });
  },
```

